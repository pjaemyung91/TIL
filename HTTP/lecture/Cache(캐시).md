Cache(캐시)

1. 캐시 : 데이터나 값을 미리 복사해 놓는 임시 장소

2. 캐시 없을 때

   a. 데이터가 변경되지 않아도 계속 네트워크를 통해서 데이터를 다운로드 받아야 함

   b. 인터넷 네트워크는 매우 느리고 비쌈

   c. 브라우저 로딩 속도가 느림

   d. 느린 사용자 경험

3. 캐시 적용 시

   a. 캐시를 먼저 조회(max-age만큼 유효함)

   b. 캐시 덕분에 캐시 가능 시간동안 네트워크를 사용하지 않아도 됨

   c. 비싼 네트워크 사용량을 줄일 수 있음

   d. 브라우저 로딩 속도가 매우 빠름

   e. 빠른 사용자 경험

4. 캐시 시간 초과 시

   a. 서버를 통해 데이터를 다시 조회하고 캐시를 갱신함 -> 네트워크 다운로드 발생

   b. 두 가지 상황 발생

   ​	- 서버에서 기존 데이터를 변경함 -> 네트워크 다운로드 발생

   ​	- 서버에서 기존 데이터를 변경하지 않음

   ​		1) 저장해 두었던 캐시를 재사용 할 수 있음

   ​		2) 클라이언트의 데이터와 서버의 데이터가 같다는 사실을 확인할 수 있는 방법이 필요 -> 검증 헤더에 Last-Modified 추가

   ​		3) 서버에 데이터 요청 시 데이터가 마지막에 수정된 시간 확인

   ​		4) 304 Not Modified + 헤더 메타 정보만 응답, HTTP Body 없음 -> 네트워크 과부하 감소

   ​		5) 클라이언트는 캐시에 저장되어 있는 데이터 재활용

5. 검증 헤더와 조건부 요청

   a. 검증 헤더

   ​	- 캐시 데이터와 서버 데이터가 같은지 검증하는 데이터

   ​	- Last-Modified, ETag

   b. 조건부 요청 헤더

   ​	- 검증 헤더로 조건에 따른 분기

   ​		1) If-Modified-Since: Last-Modified 사용

   ​			a) If-Modified-Since 조건이 만족하면 200 OK

   ​			b) 위 조건이 만족하지 않으면 304 Not Modified

   ​			c) If-Modified-Since: Last-Modified 단점

   ​				- 1초 미만 단위로 캐시 조정이 불가능

   ​				- 날짜 기반의 로직 사용

   ​				- 데이터를 수정해서 날짜가 다르지만, 같은 데이터를 수정해서 데이터 결과가 똑같은 경우

   ​				- 서버에서 별도의 캐시 로직을 관리하고 싶은 경우

   ​					(1) 스페이스나 주석처럼 크게 영향이 없는 변경에서 캐시를 유지하고 싶은 경우

   ​		2) If-None-Match: ETag 사용

   ​			a) ETag(Entity Tag)

   ​			b) 캐시용 데이터에 임의의 고유한 버전 이름을 담아둠

   ​				ex) ETag: "v1.0", ETag: "a2dskfljsl"

   ​			c) 데이터가 변경되면 이 이름을 바꿔서 변경함(Hash를 다시 생성

   ​				ex) ETag: "aaaaa" -> ETag: "bbbbb"

   ​			d) 진짜 단순하게 ETag만 보내서 같으면 유지, 다르면 다시 받기

   ​			e) 캐시 제어 로직을 서버에서 완전히 관리

   ​			f) 클라이언트는 단순히 이 값을 서버에 제공(클라이언트는 캐시 메커니즘을 모름)

6. 캐시와 조건부 요청 헤더

   a. 캐시 제어 헤더

   ​	- Cache-Control(캐시 제어)

   ​		1) max-age : 캐시 유효 시간, 초 단위

   ​		2) no-cache : 데이터는 캐시해도 되지만 항상 원(origin) 서버에 검증하고 사용

   ​		3) no-store : 데이터에 민감한 정보가 있으므로 저장하면 안됨, 메모리에서 사용하고 최대한 빨리 삭제

   ​	- Pragma(캐시 제어 - 하위 호환)

   ​		1) No-cache : HTTP 1.0 하위 호환

   ​	- Expires(캐시 유효 기간 - 하위 호환)

   ​		1) expires: Mon, 01 Jan 1990 00:00:00 GMT

   ​		2) 캐시 만료일을 정확한 날짜로 지정

   ​		3) HTTP 1.0부터 사용

   ​		4) 지금은 더 유연한 Cache-Control: max-age 권장

   ​		5) Cache-Control: max-age와 함께 사용하면 expires는 무시

7. 프록시 캐시

   a. 원 서버 중간에 캐시를 위한 서버를 두는 것 -> 응답속도가 빨라짐

8. 캐시 무효화

   a. 확실한 캐시 무효화를 위해서는 no-cache, no-store, must-revalidate, Pragma: no-cache까지 다 해야 됨

   b. must-revalidate(나머지는 위의 내용 참고)

   ​	- 캐시 만료 후 초최 조회 시 원 서버에 검증해야 됨

   ​	- 원 서버 접근 실패 시 반드시 오류가 발생해야 됨 - 504(Gateway Timeout)

   ​	- must-revalidate는 캐시 유효 시간이라면 캐시를 사용함